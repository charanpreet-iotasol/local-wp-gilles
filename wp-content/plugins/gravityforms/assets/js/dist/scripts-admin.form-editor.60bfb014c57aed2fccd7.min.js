"use strict";(self.webpackChunkgravityforms=self.webpackChunkgravityforms||[]).push([[42],{4770:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var i,r,o=n(5518),a=n(2340),s=n.n(a),l=n(7329),c=n.n(l),d=n(2452),u=n.n(d),f={labels:(0,o.getNodes)("choices-ui-label",!0),sections:(0,o.getNodes)("choices-ui-section",!0),settings:(0,o.getNodes)("choices-ui-setting",!0),flyoutTrigger:(0,o.getNodes)("choices-ui-trigger")[0],flyoutTriggerLabel:(0,o.getNodes)("choices-ui-trigger-label")[0]},v=(null===c()||void 0===c()||null===(i=c().form_editor)||void 0===i?void 0:i.choices_ui)||{},g=(null===(r=window)||void 0===r?void 0:r.SimpleBar)||{},h=function(){g.instances&&f.flyoutEl&&(g.instances.get(f.flyoutEl[0])||new g(f.flyoutEl[0]))},m=function(){var e=f.settings.filter((function(e){return"none"!==window.getComputedStyle(e).getPropertyValue("display")}));f.flyoutTrigger.style.display=e.length?"":"none",f.flyoutTriggerLabel.style.display=e.length?"":"none"},p=function(e){var t=e.title,n=void 0===t?"":t,i=e.content,r=void 0===i?null:i,a=e.position,l=void 0===a?"beforeend":a,c=e.type,d=void 0===c?"":c;if(r){s().instances.choicesUi.flyout.elements.content.insertAdjacentHTML(l,'\n\t\t<div class="choices-ui__section" data-js="choices-ui-section" data-type="'.concat(d,'">\n\t\t\t<h6 class="choices-ui__section-label">').concat((0,o.escapeHtml)(n),"</h6>\n\t\t</div>\n\t"));var u=(0,o.getNodes)("choices-ui-section",!0);u[u.length-1].appendChild(r),f.sections.push(u[u.length-1])}else(0,o.consoleError)("Gravity Forms Admin: You must supply a valid node to appendSectionHtml.")},y=function(e){var t,n,i,r;f.container=e,(0,o.trigger)({event:"gform/choices_ui/pre_init",native:!1,data:{elements:f}}),s().instances=s().instances||{},s().instances.choicesUi={},t=v.i18n,n=t.title,i=t.expandableTitle,r=t.description,s().instances.choicesUi.flyout=new(u())({description:(0,o.escapeHtml)(r),expandable:!0,expandableTitle:(0,o.escapeHtml)(i),expandableWidth:100,id:"choices-ui-flyout",maxWidth:540,mobileBreakpoint:1200,position:"absolute",simplebar:!0,target:'[data-js="form-editor"]',title:(0,o.escapeHtml)(n),triggers:'[data-js="choices-ui-trigger"]',wrapperClasses:"gform-flyout gform-flyout--choices-ui",onOpen:h,zIndex:100}),function(){s().instances.choicesUi.flyout.elements.content.insertAdjacentHTML("afterbegin",'<ul class="choices-ui__content" data-js="choices-ui-content"></ul>');var e=(0,o.getNodes)("choices-ui-content",!1,s().instances.choicesUi.flyout.elements.content)[0];f.settings.forEach((function(t){return e.appendChild(t)}))}(),f.optionsList=(0,o.getNodes)("choices-ui-option-list",!1,s().instances.choicesUi.flyout.elements.content)[0],f.settings.forEach((function(e){"option"===e.dataset.type&&f.optionsList.appendChild(e)})),f.options=(0,o.getNodes)('[data-js="choices-ui-option-list"] > li',!0,s().instances.choicesUi.flyout.elements.content,!0),s().instances.choicesUi.flyout.elements.flyout.addEventListener("click",(function(e){e.stopPropagation()})),document.addEventListener("gform/form_editor/setting_selected",m),f.flyoutEl=(0,o.getNodes)("#choices-ui-flyout .gform-flyout__body",!1,document,!0),s().instances.choicesUi.elements=f,s().instances.choicesUi.methods={appendSectionHtml:p},(0,o.trigger)({event:"gform/choices_ui/post_render",native:!1,data:s().instances.choicesUi}),(0,o.consoleInfo)("Gravity Forms Admin: Initialized choices ui flyout.")},S=function(e){y(e),(0,o.consoleInfo)("Gravity Forms Admin: Initialized all choices ui scripts.")},b=n(6655),_=n(8821),E=n(5169),k=n(9803),w=n(535),A=n(5469),F=n(2312),j=n(5311),N=n.n(j);function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,F.Z)(e);if(t){var r=(0,F.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,A.Z)(this,n)}}var T=function(e){(0,w.Z)(n,e);var t=I(n);function n(){return(0,_.Z)(this,n),t.apply(this,arguments)}return(0,E.Z)(n,[{key:"init",value:function(){var e=this;this.eventsManager.addListener("SaveRequested",this.save,this),document.addEventListener("gform/dialog/confirm",this.maybeSave.bind(this));var t,n=C(this.config.data.domEvents);try{var i=function(){var n=t.value;if(n){var i=e.eventsManager.get(n.name),r=document,o={};if("document"!==n.elementSelector&&(r=document.getElementsByClassName(n.elementSelector.replace(".",""))[0]),void 0===r)return{v:void 0};r.addEventListener(n.action,(function(t){if(!e.saveInProgress){if("keydown"===n.action&&"keys"in n&&n.keys.length>0){if(-1===n.keys.indexOf(t.keyCode))return!1;if(o[t.keyCode.toString()]=t.keyCode,!n.keys.every((function(e){return e in o!=!1})))return e.pressedKeysTimeOut=setTimeout((function(){o={}}),1e3),!1}e.saveInProgress||(s().instances.adminFormSaverUIHandler.activeElement=document.activeElement,document.activeElement.blur(),t.preventDefault(),t.stopImmediatePropagation(),o={},i.fire(),e.saveInProgress=!0)}}))}};for(n.s();!(t=n.n()).done;){var r=i();if("object"===(0,b.Z)(r))return r.v}}catch(e){n.e(e)}finally{n.f()}}},{key:"maybeSave",value:function(e){if("gform/dialog/confirm"===e.type){var t,n,i;if("dialog-embed-form-unsaved-changes"!==(null==e||null===(t=e.detail)||void 0===t||null===(n=t.instance)||void 0===n||null===(i=n.options)||void 0===i?void 0:i.id))return;this.save()}}},{key:"save",value:function(){var e=(0,o.getNodes)("force-focus")[0];if(e&&e.focus(),this.formJSONString=this.getUpdatedFormJSON(),!window.ValidateForm())return!1;(0,k.Z)((0,F.Z)(n.prototype),"save",this).call(this)}},{key:"deepSanitizeFormValues",value:function(e){if("object"!==(0,b.Z)(e))return e;for(var t in e){var n=e[t];"object"!==(0,b.Z)(n)||null===n?e[t]="string"==typeof n?n.replace(/\\'/g,"'"):n:e[t]=this.deepSanitizeFormValues(n)}return e}},{key:"getUpdatedFormJSON",value:function(){try{this.form=window.UpdateFormObject(),window.gforms_original_json=N().toJSON(this.form)}catch(e){(0,o.consoleError)(e)}var e=this.deepSanitizeFormValues(this.form);return N().toJSON(e)}}]),n}(n(5289).Z),U=n(2243),B=n(5998),x=n.n(B),L=n(1297),H=n.n(L);function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Z=function(){function e(t,n){(0,_.Z)(this,e),this.events=t,this.config=n,this.timeOuts=[],this.scripts=[],this.styles=[],this.buttons=[],this.maybeHandleNormalPostRequest(),this.initButtons(),this.bindEvents(),this.init()}return(0,E.Z)(e,[{key:"init",value:function(){var e=this;this.timeOuts.forEach((function(e){window.clearTimeout(e)})),document.getElementsByTagName("script").forEach((function(t){var n=t.getAttribute("src");null!==n&&(n=n.substring(0,n.indexOf("?ver")),e.scripts.push(n))})),document.getElementsByTagName("link").forEach((function(t){var n=t.getAttribute("href");null!==n&&(n=n.substring(0,n.indexOf("?ver")),e.styles.push(n))})),this.selectedField={}}},{key:"initButtons",value:function(){var e=this;this.config.data.selectors.saveAnimationButtons.forEach((function(t){(0,o.getNodes)(t,!0,document,!0).forEach((function(t){var n=t.id?t.id:(0,o.uniqueId)("button-");t.id=n;var i=new(H())({activeType:"loader",id:n,interactive:!0,loaderOptions:{background:"transparent",foreground:"#fff",mask:!1,showOnRender:!1,size:1.5},rendered:!0});e.buttons.push(i)}))}))}},{key:"maybeHandleNormalPostRequest",value:function(){void 0!==window.updateFormResult&&("invalid_json"===window.updateFormResult.status?this.showSaveErrorNotification():this.showSaveSuccessNotification())}},{key:"bindEvents",value:function(){this.events.addListeners([{name:"SaveBegan",handler:[this.init]},{name:"SaveInProgress",handler:this.handleSaveProgress},{name:["SaveFailed","SaveRequestFailed","SaveResponseMalformed"],handler:this.handleSaveFailure},{name:"SaveSucceeded",handler:[this.handleSaveSuccess]},{name:"SaveCompleted",handler:this.reset},{name:"SaveBegan",handler:this.beginButtonAnimation},{name:"SaveCompleted",handler:this.endButtonAnimation}],this)}},{key:"beginButtonAnimation",value:function(){this.buttons.filter((function(e){return e.options.interactive})).forEach((function(e){return e.activateButton()}))}},{key:"endButtonAnimation",value:function(){this.buttons.filter((function(e){return e.options.interactive})).forEach((function(e){return e.deactivateButton()}))}},{key:"reset",value:function(){var e=this;this.registerTimeOut((function(){e.buttons.forEach((function(e){e.deactivateButton()})),"id"in e.selectedField&&N()("#field_"+e.selectedField.id).click(),e.resetSettingsControlsDisabledState(),e.activeElement&&N()(e.activeElement).focus(),s().instances.adminFormSaver.saveInProgress=!1}),this.config.data.animationDelay)}},{key:"resetElementClasses",value:function(e,t){var n=t.classList.value;if(void 0!==n&&""!==n){n=n.split(" "),e.removeClass();for(var i=0;i<n.length;i++)""!==n[i]&&void 0!==n[i]&&e.addClass(n[i])}}},{key:"handleSaveProgress",value:function(){var e=this;this.selectedField=window.GetSelectedField(),this.selectedField||(this.selectedField={}),this.registerTimeOut((function(){x().a11y.speak(e.config.i18n.saveInProgress,"polite"),e.disableSettingsControls()}),this.config.data.animationDelay/8)}},{key:"handleSaveFailure",value:function(e){var t=this;this.registerTimeOut((function(){t.showSaveErrorNotification(e),(0,o.trigger)({event:"gform/form_editor_saver/post_save_error",native:!1})}),this.config.data.animationDelay)}},{key:"handleSaveSuccess",value:function(e){var t=this;this.registerTimeOut((function(){t.showSaveSuccessNotification(),(0,o.trigger)({event:"gform/form_editor_saver/post_save_success",native:!1})}),this.config.data.animationDelay),this.reloadEditorUI(e)}},{key:"showSaveSuccessNotification",value:function(){var e=this.config.data.urls.formPreview,t=this.config.i18n,n=t.formUpdated,i=t.viewForm;(0,o.trigger)({data:{autoHideDelay:4500,container:"#form_editor_fields_container",ctaLink:(0,o.escapeHtml)((0,o.vsprintf)(e,[window.form.id])),ctaTarget:"_blank",ctaText:(0,o.escapeHtml)(i),icon:"circle-check-alt",message:(0,o.escapeHtml)(n),type:"success"},event:"gform/snackbar/render",native:!1})}},{key:"showSaveErrorNotification",value:function(e){var t=this.config.i18n.genericError,n="string"==typeof e&&""!==e&&null!==e?e:t;(0,o.trigger)({data:{autoHideDelay:4500,container:"#form_editor_fields_container",icon:"circle-delete",message:(0,o.escapeHtml)(n),type:"error"},event:"gform/snackbar/render",native:!1})}},{key:"disableSettingsControls",value:function(){document.querySelectorAll(".field_setting input, .field_setting select, .field_setting textarea").forEach((function(e){e.setAttribute("data-js-initial-disabled-state",e.disabled),e.disabled=!0}))}},{key:"resetSettingsControlsDisabledState",value:function(){document.querySelectorAll(".field_setting input, .field_setting select, .field_setting textarea").forEach((function(e){"false"===e.getAttribute("data-js-initial-disabled-state")&&e.removeAttribute("disabled"),e.removeAttribute("data-js-initial-disabled-state")}))}},{key:"reloadEditorUI",value:function(e){try{var t=document.createElement("html");t.innerHTML=e.data.updated_markup.toString();var n=N()(t);this.reloadSettings(n),this.reloadScripts(n),this.reloadElements(n)}catch(e){}}},{key:"reloadScripts",value:function(e){var t=this;e.find("script[data-js-reload]").toArray().forEach((function(e){var n=N()(e).attr("data-js-reload"),i=N()('script[data-js-reload="'+n+'"]');if(i.length){var r=t.events.trigger("scriptBeforeReload",e,n,i.get(0));!1!==r&&void 0!==N()(r).attr("data-js-skip-reload")&&(i.replaceWith(r),t.events.trigger("scriptAfterReload",r,n,i.get(0)))}})),N()("#gform_editor_js_action_output_wrapper script").toArray().forEach((function(e){e.remove()}));var n=e.find("#gform_editor_js_action_output_wrapper").toArray().pop();!1!==(n=this.events.trigger("gformEditorJSActionBeforeReload",n))&&N()("#gform_editor_js_action_output_wrapper").replaceWith(n)}},{key:"reloadElements",value:function(e){var t=this;e.find(":not(script)[data-js-reload]").toArray().forEach((function(e){var n=N()(e).attr("data-js-reload");if("true"!==n){var i=N()(':not(script)[data-js-reload="'+n+'"]');if(i.length){var r=t.events.trigger("elementBeforeReload",e,n,i.get(0));!1!==r&&void 0===N()(r).attr("data-js-skip-reload")&&(i.replaceWith(r),t.events.trigger("elementAfterReload",r,n,i.get(0)))}}})),"id"in this.selectedField&&N()("#field_"+this.selectedField.id).addClass("field_selected")}},{key:"reloadSettings",value:function(e){var t,n=N()(".editor-sidebar"),i=N()(".gform-flyout"),r=e.find(".editor-sidebar"),o=[],a=[],s=[],l=r.find("li.field_setting").toArray(),c=n.find("li.field_setting").toArray(),d=i.find("li.field_setting").toArray(),u=this.getElementsAsClassLists(l),f=this.getElementsAsClassLists(d),v=this.getElementsAsClassLists(c),g=R(v=v.concat(f));try{for(g.s();!(t=g.n()).done;){var h=t.value;u.indexOf(h)>=0||a.push(h)}}catch(e){g.e(e)}finally{g.f()}var m,p=R(u);try{for(p.s();!(m=p.n()).done;){var y=m.value;""!==y&&(v.indexOf(y)>=0?s.push(y):o.push(y))}}catch(e){p.e(e)}finally{p.f()}this.insertNewFieldSettings(o,r),this.updateExistingFieldSettings(s,r,e),this.deleteExpiredFieldSettings(a)}},{key:"insertNewFieldSettings",value:function(e,t){var n,i=R(e);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=t.find("."+r).prevUntil().toArray();if(this.events.trigger("beforeFieldSettingAdded",[N()("."+r).get(0),t.find("."+r).get(0)]),o.length<1){var a=t.find("."+r).parent().attr("id");N()("#"+a).prepend(t.find("."+r)),this.events.trigger("afterFieldSettingAdded",[r])}else{var s,l=R(o);try{for(l.s();!(s=l.n()).done;){var c=s.value.classList.value.split(" ")[0];if(N()("."+c).length){t.find("."+r).insertAfter(N()("."+c)),this.events.trigger("afterFieldSettingAdded",[r]);break}}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){i.e(e)}finally{i.f()}}},{key:"deleteExpiredFieldSettings",value:function(e){var t,n=R(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.events.trigger("beforeFieldSettingDeleted",[i]),N()("."+i).remove(),this.events.trigger("AfterFieldSettingDeleted",[i])}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateExistingFieldSettings",value:function(e,t,n){var i=this;e.forEach((function(e){var r="."+e;N()(r).hasClass("data-js-reload")&&(i.events.trigger("fieldSettingBeforeUpdate",N()(r).get(0),t.find(r).get(0)),N()(r).replaceWith(n.find(r)),i.events.trigger("fieldSettingAfterUpdate",N()(r).get(0)))}))}},{key:"getElementsAsClassLists",value:function(e){return e.map((function(e){return e.classList.value.split(" ")[0]}))}},{key:"registerTimeOut",value:function(e,t){var n=setTimeout(e,t);return this.timeOuts.push(n),n}}]),e}(),D=(null===c()||void 0===c()?void 0:c().form_editor_save_form)||{};s().instances=(null===s()||void 0===s()?void 0:s().instances)||{};var M=function(){s().instances.formSaverEventsManager=new U.Z,s().instances.adminFormSaverUIHandler=new Z(s().instances.formSaverEventsManager,D),s().instances.adminFormSaver=new T(D,{config:D,events:s().instances.formSaverEventsManager,endpointKey:"form_editor_save_form",form:window.form}),s().instances.adminFormSaver.init()},z=function(e){S(e),M(),(0,o.consoleInfo)("Gravity Forms Admin: Initialized all form editor scripts.")}}}]);